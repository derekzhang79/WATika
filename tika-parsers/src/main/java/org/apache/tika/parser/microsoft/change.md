# 关于office解析的部分记录

## 1.4月23日bug处理记录

### 1.1 bug信息

抽取office的word文档中嵌套的加密压缩文件抛出异常信息：<br/>
>* TikaException:Zip bomb detected!
>* SecureSAXException :Suspected zip bomb : 10 levels of package entry nesting

### 1.2 bug原因

出现上述异常的原因是由于tika在解析文档的时候，如果文档中有嵌套的文件，在执行抽词的时候同样会抽取嵌套文件中的文本内容，导致当前解析的压缩文件过多抛出的异常。

### 1.3 解决方案

将office中的文件解析时对于嵌套文件的抽取文本内容的功能进行关闭。

### 1.4 处理结果

doc文件抽取文本内容的时候不再进行嵌套文件的抽词，异常得到处理。

### 1.5 记录时间

2018年4月23日15:17:38

### 1.6 关于解决的思路

tika中的抽取主要是可以看作两个部分：一是单纯的抽取文本内容，即抽词；
二是对于文件中的嵌套资源的处理。一般情况下，这两个部分在文件处理的时候开启着的。处理文件的时候抽词一般都有两个部分的内容，一个是文件中的文本，另一个则是嵌套文件的文本内容。
这里修改的嵌套抽取工具类是EmbeddedDocumentUtil,将解析嵌套文件方法中的html是否输出的默认值修改为false。这样修改就可以关闭嵌套文件中的文本内容（需注意的是：这是部分的，因为在EmbeddedDocumentUtil的使用过程中某些解析情况会重新设置这个值）。